---
- name: cs_template tests (not running in Simulator mode yet)
  when: cs_template_hypervisor|lower != 'simulator'
  block:
  - name: setup template
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      state: absent
    register: template
  - name: verify setup template
    assert:
      that:
      - template is successful

  - name: test download template in check mode
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      url: "{{ cs_template_url }}"
      format: "{{ cs_template_format }}"
      hypervisor: "{{ cs_template_hypervisor }}"
      os_type: "{{ cs_template_os_type }}"
      cross_zones: yes
    register: template
    check_mode: yes
  - name: verify test download template in check mode
    assert:
      that:
      - template is changed

  - name: test download template
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      url: "{{ cs_template_url }}"
      format: "{{ cs_template_format }}"
      hypervisor: "{{ cs_template_hypervisor }}"
      os_type: "{{ cs_template_os_type }}"
      cross_zones: yes
    register: template
  - name: verify test download template
    assert:
      that:
      - template is changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template"
      - template.cross_zones == true

  - name: test download template idempotence
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      url: "{{ cs_template_url }}"
      format: "{{ cs_template_format }}"
      hypervisor: "{{ cs_template_hypervisor }}"
      os_type: "{{ cs_template_os_type }}"
      cross_zones: yes
    register: template
  - name: verify test download template idempotence
    assert:
      that:
      - template is not changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template"
      - template.cross_zones == true

  - name: test update template in check mdoe
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      display_text: "{{ cs_resource_prefix }}-template display_text"
      url: "{{ cs_template_url }}"
      format: "{{ cs_template_format }}"
      hypervisor: "{{ cs_template_hypervisor }}"
      os_type: "{{ cs_template_os_type }}"
      cross_zones: yes
    register: template
    check_mode: yes
  - name: verify test update template in check mode
    assert:
      that:
      - template is changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template"
      - template.cross_zones == true

  - name: test update template
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      display_text: "{{ cs_resource_prefix }}-template display_text"
      url: "{{ cs_template_url }}"
      format: "{{ cs_template_format }}"
      hypervisor: "{{ cs_template_hypervisor }}"
      os_type: "{{ cs_template_os_type }}"
      cross_zones: yes
    register: template
  - name: verify test update template
    assert:
      that:
      - template is changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template display_text"
      - template.cross_zones == true

  - name: test update template idempotence
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      display_text: "{{ cs_resource_prefix }}-template display_text"
      url: "{{ cs_template_url }}"
      format: "{{ cs_template_format }}"
      hypervisor: "{{ cs_template_hypervisor }}"
      os_type: "{{ cs_template_os_type }}"
      cross_zones: yes
    register: template
  - name: verify test update template idempotence
    assert:
      that:
      - template is not changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template display_text"
      - template.cross_zones == true

  - name: test remove template in check mode
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      state: absent
      cross_zones: yes
    register: template
    check_mode: yes
  - name: verify test remove template in check mode
    assert:
      that:
      - template is changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template display_text"
      - template.cross_zones == true

  - name: test remove template
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      state: absent
      cross_zones: yes
    register: template
  - name: verify test remove template
    assert:
      that:
      - template is changed
      - template.name == "{{ cs_resource_prefix }}-template"
      - template.display_text == "{{ cs_resource_prefix }}-template display_text"
      - template.cross_zones == true

  - name: test remove template idempotence
    cs_template:
      name: "{{ cs_resource_prefix }}-template"
      state: absent
      cross_zones: yes
    register: template
  - name: verify test remove template idempotence
    assert:
      that:
      - template is not changed
