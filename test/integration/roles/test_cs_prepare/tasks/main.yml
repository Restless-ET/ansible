---
- name: create temporary build directory
  local_action:
    module: tempfile
    state: directory
    suffix: build
  register: tmp

- name: download API keys
  local_action:
    module: get_url
    url: "{{ cs_prepare_api_endpoint }}/admin-keys.json"
    url_username: "{{ cs_prepare_url_username }}"
    url_password: "{{ cs_prepare_url_password }}"
    force_basic_auth: true
    force: true
    dest: "{{ tmp.path }}/admin-keys.json"

- name: load API keys as vars
  include_vars: "{{ tmp.path }}/admin-keys.json"
  no_log: true

- name: create cloudstack.ini of API keys as vars
  local_action:
    module: template
    src: cloudstack.ini.j2
    dest: ./cloudstack.ini
